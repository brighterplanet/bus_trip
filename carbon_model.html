<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>carbon_model.rb</title>
  <link rel="stylesheet" href="http://jashkenas.github.com/docco/resources/docco.css">
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1667526-20']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
</head>

<body>
<div id='container'>
  <div id="background"></div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>carbon_model.rb</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-1'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-1">&#182;</a>
        </div>
        <p>Copyright Â© 2010 Brighter Planet.
See LICENSE for details.
Contact Brighter Planet for dual-license arrangements.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-Bus_trip_carbon_model'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Bus_trip_carbon_model">&#182;</a>
        </div>
        <h1>Bus trip carbon model</h1>

<p>This model is used by <a href="http://brighterplanet.com">Brighter Planet</a>&rsquo;s carbon emission <a href="http://carbon.brighterplanet.com">web service</a> to estimate the <strong>greenhouse gas emissions of passenger bus travel</strong>.</p>

<h4>Timeframe and activity period</h4>

<p>The model estimates the emissions that occur during a particular <code>timeframe</code>. To do this it needs to know the <code>date</code> on which the trip occurred. For example, if the <code>timeframe</code> is January 2010, a trip that occurred on January 5, 2010 will have emissions but a trip that occurred on February 1, 2010 will not.</p>

<h4>Calculations</h4>

<p>The final estimate is the result of the <strong>calculations</strong> detailed below. These calculations are performed in reverse order, starting with the last calculation listed and finishing with the <code>emission</code> calculation. Each calculation is named according to the value it returns.</p>

<h4>Methods</h4>

<p>To accomodate varying client input, each calculation may have one or more <strong>methods</strong>. These are listed under each calculation in order from most to least preferred. Each method is named according to the values it requires. If any of these values is not available the method will be ignored. If all the methods for a calculation are ignored, the calculation will not return a value. &ldquo;Default&rdquo; methods do not require any values, and so a calculation with a default method will always return a value.</p>

<h4>Standard compliance</h4>

<p>Each method lists any established calculation standards with which it <strong>complies</strong>. When compliance with a standard is requested, all methods that do not comply with that standard are ignored. This means that any values a particular method requires will have been calculated using a compliant method, because those are the only methods available. If any value did not have a compliant method in its calculation then it would be undefined, and the current method would have been ignored.</p>

<h4>Collaboration</h4>

<p>Contributions to this carbon model are actively encouraged and warmly welcomed. This library includes a comprehensive test suite to ensure that your changes do not cause regressions. All changes should include test coverage for new functionality. Please see <a href="https://github.com/brighterplanet/sniff#readme">sniff</a>, our emitter testing framework, for more information.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="k">module</span> <span class="nn">BrighterPlanet</span>
  <span class="k">module</span> <span class="nn">BusTrip</span>
    <span class="k">module</span> <span class="nn">CarbonModel</span>
      <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
        <span class="n">base</span><span class="o">.</span><span class="n">decide</span> <span class="ss">:emission</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="ss">:characteristics</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-Emission_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Emission_calculation">&#182;</a>
        </div>
        <h2>Emission calculation</h2>

<p>Returns the <code>emission</code> estimate (<em>kg CO<sub>2</sub>e</em>)</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:emission</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-Emission_from_CO&lt;sub&gt;2&lt;/sub&gt;_emission,_CH&lt;sub&gt;4&lt;/sub&gt;_emission,_N&lt;sub&gt;2&lt;/sub&gt;O_emission,_and_HFC_emission'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Emission_from_CO&lt;sub&gt;2&lt;/sub&gt;_emission,_CH&lt;sub&gt;4&lt;/sub&gt;_emission,_N&lt;sub&gt;2&lt;/sub&gt;O_emission,_and_HFC_emission">&#182;</a>
        </div>
        <h3>Emission from CO<sub>2</sub> emission, CH<sub>4</sub> emission, N<sub>2</sub>O emission, and HFC emission</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from co2 emission, ch4 emission, n2o emission, and hfc emission&#39;</span><span class="p">,</span>
              <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:co2_emission</span><span class="p">,</span> <span class="ss">:ch4_emission</span><span class="p">,</span> <span class="ss">:n2o_emission</span><span class="p">,</span> <span class="ss">:hfc_emission</span><span class="o">]</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-5'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-5">&#182;</a>
        </div>
        <p><strong>Complies:</strong> GHG Protocol Scope 3, ISO 14064-1, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-6'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-6">&#182;</a>
        </div>
        <ul>
<li>Sums the non-biogenic emissions to give <em>kg CO<sub>2</sub>e</em>.</li>
</ul>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="n">characteristics</span><span class="o">[</span><span class="ss">:co2_emission</span><span class="o">]</span> <span class="o">+</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:ch4_emission</span><span class="o">]</span> <span class="o">+</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:n2o_emission</span><span class="o">]</span> <span class="o">+</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:hfc_emission</span><span class="o">]</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-CO&lt;sub&gt;2&lt;/sub&gt;_emission_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-CO&lt;sub&gt;2&lt;/sub&gt;_emission_calculation">&#182;</a>
        </div>
        <h2>CO<sub>2</sub> emission calculation</h2>

<p>Returns the <code>co2 emission</code> per passenger (<em>kg / l</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:co2_emission</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-CO&lt;sub&gt;2&lt;/sub&gt;_emission_from_distance,_bus_class,_passengers,_date,_and_timeframe'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-CO&lt;sub&gt;2&lt;/sub&gt;_emission_from_distance,_bus_class,_passengers,_date,_and_timeframe">&#182;</a>
        </div>
        <h3>CO<sub>2</sub> emission from distance, bus class, passengers, date, and timeframe</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from distance, bus class, passengers, date, and timeframe&#39;</span><span class="p">,</span>
              <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:distance</span><span class="p">,</span> <span class="ss">:bus_class</span><span class="p">,</span> <span class="ss">:date</span><span class="p">,</span> <span class="ss">:passengers</span><span class="o">]</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-9'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-9">&#182;</a>
        </div>
        <p><strong>Complies:</strong> GHG Protocol Scope 3, ISO 14046-1, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="p">,</span> <span class="n">timeframe</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-10'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-10">&#182;</a>
        </div>
        <p>Checks whether the trip <code>date</code> falls within the <code>timeframe</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                <span class="n">date</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">].</span><span class="n">is_a?</span><span class="p">(</span><span class="no">Date</span><span class="p">)</span> <span class="p">?</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">]</span> <span class="p">:</span>
                  <span class="no">Date</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">].</span><span class="n">to_s</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">timeframe</span><span class="o">.</span><span class="n">include?</span> <span class="n">date</span></pre></div>
      </td>
    </tr>
    <tr id='section-11'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-11">&#182;</a>
        </div>
        <p>Multiplies each fuel intensity (<em>l / km</em>) for the <a href="http://data.brighterplanet.com/bus_classes">bus class</a> by that <a href="http://data.brighterplanet.com/bus_fuels">fuel</a>&rsquo;s <code>co2 emission factor</code> (<em>kg / l</em>) and sums to give a combined <code>co2 emission factor</code> (<em>kg / km</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                  <span class="n">combined_ef</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">gasoline_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Gasoline&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">diesel_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Diesel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">cng_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;CNG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">lng_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;LNG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">lpg_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;LPG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">methanol_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Methanol&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">biodiesel_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Biodiesel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_emission_factor</span></pre></div>
      </td>
    </tr>
    <tr id='section-12'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-12">&#182;</a>
        </div>
        <p>Multiplies distance (<em>km</em>) by the combined <code>co2 emission factor</code> (<em>kg / km</em>) and divides by <code>passengers</code> to give <em>kg</em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance</span><span class="o">]</span> <span class="o">*</span> <span class="n">combined_ef</span> <span class="o">/</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:passengers</span><span class="o">]</span>
                <span class="k">else</span></pre></div>
      </td>
    </tr>
    <tr id='section-13'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-13">&#182;</a>
        </div>
        <p>If the <code>date</code> does not fall within the <code>timeframe</code>, <code>co2 emission</code> is zero.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                  <span class="mi">0</span>
                <span class="k">end</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-CO&lt;sub&gt;2&lt;/sub&gt;_biogenic_emission_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-CO&lt;sub&gt;2&lt;/sub&gt;_biogenic_emission_calculation">&#182;</a>
        </div>
        <h2>CO<sub>2</sub> biogenic emission calculation</h2>

<p>Returns the <code>co2 biogenic emission</code> (<em>kg / l</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:co2_biogenic_emission</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-CO&lt;sub&gt;2&lt;/sub&gt;_biogenic_emission_from_distance,_bus_class,_passengers,_date,_and_timeframe'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-CO&lt;sub&gt;2&lt;/sub&gt;_biogenic_emission_from_distance,_bus_class,_passengers,_date,_and_timeframe">&#182;</a>
        </div>
        <h3>CO<sub>2</sub> biogenic emission from distance, bus class, passengers, date, and timeframe</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from distance, bus class, passengers, date, and timeframe&#39;</span><span class="p">,</span>
              <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:distance</span><span class="p">,</span> <span class="ss">:bus_class</span><span class="p">,</span> <span class="ss">:date</span><span class="p">,</span> <span class="ss">:passengers</span><span class="o">]</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-16'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-16">&#182;</a>
        </div>
        <p><strong>Complies:</strong> GHG Protocol Scope 3, ISO 14046-1, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="p">,</span> <span class="n">timeframe</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-17'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-17">&#182;</a>
        </div>
        <p>Checks whether the trip <code>date</code> falls within the <code>timeframe</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                <span class="n">date</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">].</span><span class="n">is_a?</span><span class="p">(</span><span class="no">Date</span><span class="p">)</span> <span class="p">?</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">]</span> <span class="p">:</span>
                  <span class="no">Date</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">].</span><span class="n">to_s</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">timeframe</span><span class="o">.</span><span class="n">include?</span> <span class="n">date</span></pre></div>
      </td>
    </tr>
    <tr id='section-18'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-18">&#182;</a>
        </div>
        <p>Multiplies each fuel intensity (<em>l / km</em>) for the <a href="http://data.brighterplanet.com/bus_classes">bus class</a> by that <a href="http://data.brighterplanet.com/bus_fuels">fuel</a>&rsquo;s <code>co2 biogenic emission factor</code> (<em>kg / l</em>) and sums to give a combined <code>co2 biogenic emission factor</code> (<em>kg / km</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                  <span class="n">combined_ef</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">gasoline_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Gasoline&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_biogenic_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">diesel_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Diesel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_biogenic_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">cng_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;CNG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_biogenic_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">lng_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;LNG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_biogenic_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">lpg_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;LPG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_biogenic_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">methanol_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Methanol&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_biogenic_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">biodiesel_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Biodiesel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_biogenic_emission_factor</span></pre></div>
      </td>
    </tr>
    <tr id='section-19'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-19">&#182;</a>
        </div>
        <p>Multiplies distance (<em>km</em>) by the combined <code>co2 biogenic emission factor</code> (<em>kg / km</em>) and divides by <code>passengers</code> to give <em>kg</em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance</span><span class="o">]</span> <span class="o">*</span> <span class="n">combined_ef</span> <span class="o">/</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:passengers</span><span class="o">]</span>
                <span class="k">else</span></pre></div>
      </td>
    </tr>
    <tr id='section-20'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-20">&#182;</a>
        </div>
        <p>If the <code>date</code> does not fall within the <code>timeframe</code>, <code>co2 biogenic emission</code> is zero.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                  <span class="mi">0</span>
                <span class="k">end</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-CH&lt;sub&gt;4&lt;/sub&gt;_emission_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-CH&lt;sub&gt;4&lt;/sub&gt;_emission_calculation">&#182;</a>
        </div>
        <h2>CH<sub>4</sub> emission calculation</h2>

<p>Returns the <code>ch4 emission</code> (<em>kg co2e / l</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:ch4_emission</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-CH&lt;sub&gt;4&lt;/sub&gt;_emission_from_distance,_bus_class,_passengers,_date,_and_timeframe'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-CH&lt;sub&gt;4&lt;/sub&gt;_emission_from_distance,_bus_class,_passengers,_date,_and_timeframe">&#182;</a>
        </div>
        <h3>CH<sub>4</sub> emission from distance, bus class, passengers, date, and timeframe</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from distance, bus class, passengers, date, and timeframe&#39;</span><span class="p">,</span>
              <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:distance</span><span class="p">,</span> <span class="ss">:bus_class</span><span class="p">,</span> <span class="ss">:passengers</span><span class="p">,</span> <span class="ss">:date</span><span class="o">]</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-23'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-23">&#182;</a>
        </div>
        <p><strong>Complies:</strong> GHG Protocol Scope 3, ISO 14046-1, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="p">,</span> <span class="n">timeframe</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-24'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-24">&#182;</a>
        </div>
        <p>Checks whether the trip <code>date</code> falls within the <code>timeframe</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                <span class="n">date</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">].</span><span class="n">is_a?</span><span class="p">(</span><span class="no">Date</span><span class="p">)</span> <span class="p">?</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">]</span> <span class="p">:</span>
                  <span class="no">Date</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">].</span><span class="n">to_s</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">timeframe</span><span class="o">.</span><span class="n">include?</span> <span class="n">date</span></pre></div>
      </td>
    </tr>
    <tr id='section-25'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-25">&#182;</a>
        </div>
        <p>Multiplies each fuel intensity (<em>l / km</em>) for the <a href="http://data.brighterplanet.com/bus_classes">bus class</a> by that <a href="http://data.brighterplanet.com/bus_fuels">fuel</a>&rsquo;s <code>ch4 emission factor</code> (<em>kg CO<sub>2</sub>e / km</em>) and sums to give a combined <code>ch4 emission factor</code> (<em>kg CO<sub>2</sub>e l / km<sup>2</sup></em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                  <span class="n">combined_ef</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">gasoline_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Gasoline&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ch4_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">diesel_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Diesel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ch4_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">cng_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;CNG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ch4_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">lng_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;LNG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ch4_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">lpg_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;LPG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ch4_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">methanol_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Methanol&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ch4_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">biodiesel_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Biodiesel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ch4_emission_factor</span></pre></div>
      </td>
    </tr>
    <tr id='section-26'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-26">&#182;</a>
        </div>
        <p>Adds the individual fuel intensities for the <a href="http://data.brighterplanet.com/bus_classes">bus class</a> to give <code>total fuel intensity</code> (<em>l / km</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                  <span class="n">total_intensity</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">gasoline_intensity</span> <span class="o">+</span>
                                    <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">diesel_intensity</span> <span class="o">+</span>
                                    <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">cng_intensity</span> <span class="o">+</span>
                                    <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">lng_intensity</span> <span class="o">+</span>
                                    <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">lpg_intensity</span> <span class="o">+</span>
                                    <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">methanol_intensity</span> <span class="o">+</span>
                                    <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">biodiesel_intensity</span></pre></div>
      </td>
    </tr>
    <tr id='section-27'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-27">&#182;</a>
        </div>
        <p>Divides the combined <code>ch4 emission factor</code> (<em>kg CO<sub>2</sub>e l / km<sup>2</sup></em>) by the total intensity (<em>l / km</em>), multiplies by distance (<em>km</em>), and divides by <code>passengers</code> to give <em>kg CO<sub>2</sub>e</em>.
(This distributes the total travel between the various fuels; we need to do this because the <code>ch4 emission factor</code> is emission per unit distance rather than per unit fuel.)</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                  <span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance</span><span class="o">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">combined_ef</span> <span class="o">/</span> <span class="n">total_intensity</span><span class="p">))</span> <span class="o">/</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:passengers</span><span class="o">]</span>
                <span class="k">else</span></pre></div>
      </td>
    </tr>
    <tr id='section-28'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-28">&#182;</a>
        </div>
        <p>If the <code>date</code> does not fall within the <code>timeframe</code>, <code>ch4 emission</code> is zero.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                  <span class="mi">0</span>
                <span class="k">end</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-N&lt;sub&gt;2&lt;/sub&gt;O_emission_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-N&lt;sub&gt;2&lt;/sub&gt;O_emission_calculation">&#182;</a>
        </div>
        <h2>N<sub>2</sub>O emission calculation</h2>

<p>Returns the <code>n2o emission</code> (<em>kg CO<sub>2</sub>e / l</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:n2o_emission</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-N&lt;sub&gt;2&lt;/sub&gt;O_emission_from_distance,_bus_class,_passengers,_date,_and_timeframe'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-N&lt;sub&gt;2&lt;/sub&gt;O_emission_from_distance,_bus_class,_passengers,_date,_and_timeframe">&#182;</a>
        </div>
        <h3>N<sub>2</sub>O emission from distance, bus class, passengers, date, and timeframe</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from distance, bus class, passengers, date, and timeframe&#39;</span><span class="p">,</span>
              <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:distance</span><span class="p">,</span> <span class="ss">:bus_class</span><span class="p">,</span> <span class="ss">:passengers</span><span class="p">,</span> <span class="ss">:date</span><span class="o">]</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-31'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-31">&#182;</a>
        </div>
        <p><strong>Complies:</strong> GHG Protocol Scope 3, ISO 14046-1, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="p">,</span> <span class="n">timeframe</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-32'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-32">&#182;</a>
        </div>
        <p>Checks whether the trip <code>date</code> falls within the <code>timeframe</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                <span class="n">date</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">].</span><span class="n">is_a?</span><span class="p">(</span><span class="no">Date</span><span class="p">)</span> <span class="p">?</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">]</span> <span class="p">:</span>
                  <span class="no">Date</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">].</span><span class="n">to_s</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">timeframe</span><span class="o">.</span><span class="n">include?</span> <span class="n">date</span></pre></div>
      </td>
    </tr>
    <tr id='section-33'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-33">&#182;</a>
        </div>
        <p>Multiplies each fuel intensity (<em>l / km</em>) for the <a href="http://data.brighterplanet.com/bus_classes">bus class</a> by that <a href="http://data.brighterplanet.com/bus_fuels">fuel</a>&rsquo;s <code>n2o emission factor</code> (<em>kg CO<sub>2</sub>e / km</em>) and sums to give a combined <code>n2o emission factor</code> (<em>kg CO<sub>2</sub>e l / km<sup>2</sup></em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                  <span class="n">combined_ef</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">gasoline_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Gasoline&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">n2o_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">diesel_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Diesel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">n2o_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">cng_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;CNG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">n2o_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">lng_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;LNG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">n2o_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">lpg_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;LPG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">n2o_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">methanol_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Methanol&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">n2o_emission_factor</span> <span class="o">+</span>
                                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">biodiesel_intensity</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Biodiesel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">n2o_emission_factor</span></pre></div>
      </td>
    </tr>
    <tr id='section-34'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-34">&#182;</a>
        </div>
        <p>Adds the individual fuel intensities for the <a href="http://data.brighterplanet.com/bus_classes">bus class</a> to give <code>total fuel intensity</code> (<em>l / km</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                  <span class="n">total_intensity</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">gasoline_intensity</span> <span class="o">+</span>
                                    <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">diesel_intensity</span> <span class="o">+</span>
                                    <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">cng_intensity</span> <span class="o">+</span>
                                    <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">lng_intensity</span> <span class="o">+</span>
                                    <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">lpg_intensity</span> <span class="o">+</span>
                                    <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">methanol_intensity</span> <span class="o">+</span>
                                    <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">biodiesel_intensity</span></pre></div>
      </td>
    </tr>
    <tr id='section-35'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-35">&#182;</a>
        </div>
        <p>Divides the combined <code>n2o emission factor</code> (<em>kg CO<sub>2</sub>e l / km<sup>2</sup></em>) by the total intensity (<em>l / km</em>), multiplies by distance (<em>km</em>), and divides by <code>passengers</code> to give <em>kg CO<sub>2</sub>e</em>.
(This distributes the total travel between the various fuels; we need to do this because the <code>n2o emission factor</code> is emission per unit distance rather than per unit fuel.)</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                  <span class="n">combined_ef</span> <span class="o">/</span> <span class="n">total_intensity</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance</span><span class="o">]</span> <span class="o">/</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:passengers</span><span class="o">]</span>
                <span class="k">else</span></pre></div>
      </td>
    </tr>
    <tr id='section-36'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-36">&#182;</a>
        </div>
        <p>If the <code>date</code> does not fall within the <code>timeframe</code>, <code>n2o emission</code> is zero.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                  <span class="mi">0</span>
                <span class="k">end</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-HFC_emission_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-HFC_emission_calculation">&#182;</a>
        </div>
        <h2>HFC emission calculation</h2>

<p>Returns the <code>hfc emission</code> (<em>kg CO<sub>2</sub></em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:hfc_emission</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-HFC_emission_from_distance,_bus_class,_passengers,_date,_and_timeframe'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-HFC_emission_from_distance,_bus_class,_passengers,_date,_and_timeframe">&#182;</a>
        </div>
        <h3>HFC emission from distance, bus class, passengers, date, and timeframe</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from distance, bus class, passengers, date, and timeframe&#39;</span><span class="p">,</span>
              <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:distance</span><span class="p">,</span> <span class="ss">:bus_class</span><span class="p">,</span> <span class="ss">:passengers</span><span class="p">,</span> <span class="ss">:date</span><span class="o">]</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-39'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-39">&#182;</a>
        </div>
        <p><strong>Complies:</strong> GHG Protocol Scope 3, ISO 14046-1, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="p">,</span> <span class="n">timeframe</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-40'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-40">&#182;</a>
        </div>
        <p>Checks whether the trip <code>date</code> falls within the <code>timeframe</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                <span class="n">date</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">].</span><span class="n">is_a?</span><span class="p">(</span><span class="no">Date</span><span class="p">)</span> <span class="p">?</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">]</span> <span class="p">:</span>
                  <span class="no">Date</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">].</span><span class="n">to_s</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">timeframe</span><span class="o">.</span><span class="n">include?</span> <span class="n">date</span></pre></div>
      </td>
    </tr>
    <tr id='section-41'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-41">&#182;</a>
        </div>
        <p>Looks up <code>HFC emission factor</code> (<em>kg CO<sub>2</sub>e / km</em>) for the <a href="http://data.brighterplanet.com/bus_classes">bus class</a>, multiplies by the <code>distance</code> (<em>km</em>), and divides by <code>passengers</code> to give <em>kg CO<sub>2</sub>e</em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance</span><span class="o">]</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">air_conditioning_emission_factor</span> <span class="o">/</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:passengers</span><span class="o">]</span>
                <span class="k">else</span></pre></div>
      </td>
    </tr>
    <tr id='section-42'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-42">&#182;</a>
        </div>
        <p>If the <code>date</code> does not fall within the <code>timeframe</code>, <code>HFC emission</code> is zero.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                  <span class="mi">0</span>
                <span class="k">end</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Distance_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Distance_calculation">&#182;</a>
        </div>
        <h2>Distance calculation</h2>

<p>Returns the <code>distance</code> travelled (<em>km</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:distance</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-Distance_from_client_input'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Distance_from_client_input">&#182;</a>
        </div>
        <h3>Distance from client input</h3>

<p><strong>Complies:</strong> All</p>

<p>Uses the client-input <code>distance</code> (<em>km</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            </pre></div>
      </td>
    </tr>
    <tr id='section-Distance_from_duration_and_speed'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Distance_from_duration_and_speed">&#182;</a>
        </div>
        <h3>Distance from duration and speed</h3>

<p><strong>Complies:</strong> GHG Protocol Scope 3, ISO 14064-1, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from duration and speed&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:duration</span><span class="p">,</span> <span class="ss">:speed</span><span class="o">]</span><span class="p">,</span> <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-46'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-46">&#182;</a>
        </div>
        <p>Divides <code>duration</code> (<em>seconds</em>) by 3600 and multiplies by <code>speed</code> (<em>km / hour</em>) to give <em>km</em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="n">characteristics</span><span class="o">[</span><span class="ss">:duration</span><span class="o">]</span> <span class="o">/</span> <span class="mi">3600</span><span class="o">.</span><span class="mi">0</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:speed</span><span class="o">]</span>
            <span class="k">end</span>
            </pre></div>
      </td>
    </tr>
    <tr id='section-Distance_from_bus_class'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Distance_from_bus_class">&#182;</a>
        </div>
        <h3>Distance from bus class</h3>

<p><strong>Complies:</strong></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from bus class&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:bus_class</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-48'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-48">&#182;</a>
        </div>
        <p>Looks up the <a href="http://data.brighterplanet.com/bus_classes">bus class</a> <code>distance</code> (<em>km</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">distance</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Speed_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Speed_calculation">&#182;</a>
        </div>
        <h2>Speed calculation</h2>

<p>Returns the average <code>speed</code> (<em>km / hour</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:speed</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-Speed_from_bus_class'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Speed_from_bus_class">&#182;</a>
        </div>
        <h3>Speed from bus class</h3>

<p><strong>Complies:</strong> GHG Protocol Scope 3, ISO 14064-1, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from bus class&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:bus_class</span><span class="p">,</span> <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-51'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-51">&#182;</a>
        </div>
        <p>Looks up the <a href="http://data.brighterplanet.com/bus_classes">bus class</a>&lsquo; average <code>speed</code> (<em>km / hour</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">speed</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Duration_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Duration_calculation">&#182;</a>
        </div>
        <h2>Duration calculation</h2>

<p>Returns the trip&rsquo;s <code>duration</code> (<em>seconds</em>).</p>

<h3>Duration from client input</h3>

<p><strong>Complies:</strong> All</p>

<p>Uses the client-input <code>duration</code> (<em>seconds</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          </pre></div>
      </td>
    </tr>
    <tr id='section-Passengers_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Passengers_calculation">&#182;</a>
        </div>
        <h2>Passengers calculation</h2>

<p>Returns the number of <code>passengers</code> on the bus.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:passengers</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-Passengers_from_bus_class'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Passengers_from_bus_class">&#182;</a>
        </div>
        <h3>Passengers from bus class</h3>

<p><strong>Complies:</strong> GHG Protocol Scope 3, ISO 14064-1, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from bus class&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:bus_class</span><span class="p">,</span> <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-55'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-55">&#182;</a>
        </div>
        <p>Looks up the <a href="http://data.brighterplanet.com/bus_classes">bus class</a>&lsquo; average number of <code>passengers</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">passengers</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Bus_class_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Bus_class_calculation">&#182;</a>
        </div>
        <h2>Bus class calculation</h2>

<p>Returns the <code>bus class</code>.
This is the type of bus used.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:bus_class</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-From_client_input'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-From_client_input">&#182;</a>
        </div>
        <h3>From client input</h3>

<p><strong>Complies:</strong> All</p>

<p>Uses the client-input <a href="http://data.brighterplanet.com/bus_classes">bus class</a>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            </pre></div>
      </td>
    </tr>
    <tr id='section-Default_bus_class'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Default_bus_class">&#182;</a>
        </div>
        <h3>Default bus class</h3>

<p><strong>Complies:</strong> GHG Protocol Scope 3, ISO 14064-1, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-59'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-59">&#182;</a>
        </div>
        <p>Uses a fallback <a href="http://data.brighterplanet.com/bus_classes">bus class</a> that represents the U.S. average.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="no">BusClass</span><span class="o">.</span><span class="n">fallback</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Date_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Date_calculation">&#182;</a>
        </div>
        <h2>Date calculation</h2>

<p>Returns the <code>date</code> on which the trip occurred.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:date</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-Date_from_client_input'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Date_from_client_input">&#182;</a>
        </div>
        <h3>Date from client input</h3>

<p><strong>Complies:</strong> All</p>

<p>Uses the client-input <code>date</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            </pre></div>
      </td>
    </tr>
    <tr id='section-Date_from_timeframe'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Date_from_timeframe">&#182;</a>
        </div>
        <h3>Date from timeframe</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from timeframe&#39;</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-63'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-63">&#182;</a>
        </div>
        <p><strong>Complies:</strong> GHG Protocol Scope 3, ISO-14064-1, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="p">,</span> <span class="n">timeframe</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-64'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-64">&#182;</a>
        </div>
        <p>Assumes the trip occurred on the first day of the <code>timeframe</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                <span class="n">timeframe</span><span class="o">.</span><span class="n">from</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Timeframe_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Timeframe_calculation">&#182;</a>
        </div>
        <h2>Timeframe calculation</h2>

<p>Returns the <code>timeframe</code>.
This is the period during which to calculate emissions.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            </pre></div>
      </td>
    </tr>
    <tr id='section-Timeframe_from_client_input'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Timeframe_from_client_input">&#182;</a>
        </div>
        <h3>Timeframe from client input</h3>

<p><strong>Complies:</strong> All</p>

<p>Uses the client-input <code>timeframe</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            </pre></div>
      </td>
    </tr>
    <tr id='section-Default_timeframe'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Default_timeframe">&#182;</a>
        </div>
        <h3>Default timeframe</h3>

<p><strong>Complies:</strong> All</p>

<p>Uses the current calendar year.</p>

      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
