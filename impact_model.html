<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>impact_model.rb</title>
  <link rel="stylesheet" href="http://jashkenas.github.com/docco/resources/docco.css">
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1667526-20']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <style type="text/css">
    td.docs h1 {
      margin-top: 0;
    }
    @media print {
      .code pre {
        white-space: pre-wrap;
      }
      .code {
        padding-left: 0 !important;
        padding-right: 0 !important;
      }
      .code .highlight {
        margin-left: 15px;
        margin-right: 15px;
      }
    }
  </style>
</head>

<body>
<div id='container'>
  <div id="background"></div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>impact_model.rb</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-1'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-1">&#182;</a>
        </div>
        <p>Copyright Â© 2010 Brighter Planet.
See LICENSE for details.
Contact Brighter Planet for dual-license arrangements.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-Bus_trip_impact_model'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Bus_trip_impact_model">&#182;</a>
        </div>
        <h2>Bus trip impact model</h2>

<p>This model is used by the <a href="http://brighterplanet.com">Brighter Planet</a> <a href="http://impact.brighterplanet.com">CM1 web service</a> to calculate the per-passenger impacts of a bus trip, such as energy use and greenhouse gas emissions.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-Timeframe'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Timeframe">&#182;</a>
        </div>
        <h4>Timeframe</h4>

<p>The model calculates impacts that occured during a particular time period (<code>timeframe</code>).
For example if the <code>timeframe</code> is February 2010, a trip that occurred (<code>date</code>) on February 15, 2010 will have impacts, but a trip that occurred on January 31, 2010 will have zero impacts.</p>

<p>The default <code>timeframe</code> is the current calendar year.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-Calculations'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Calculations">&#182;</a>
        </div>
        <h4>Calculations</h4>

<p>The final impacts are the result of the calculations below. These are performed in reverse order, starting with the last calculation listed and finishing with the greenhouse gas emissions calculation.</p>

<p>Each calculation listing shows:</p>

<ul>
<li>value returned (<em>units of measurement</em>)</li>
<li>description of the value</li>
<li>calculation methods, listed from most to least preferred</li>
</ul>


<p>Some methods use <code>values</code> returned by prior calculations. If any of these <code>values</code> are unknown the method is skipped.
If all the methods for a calculation are skipped, the value the calculation would return is unknown.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-Standard_compliance'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Standard_compliance">&#182;</a>
        </div>
        <h4>Standard compliance</h4>

<p>When compliance with a particular standard is requested, all methods that do not comply with that standard are ignored.
Thus any <code>values</code> a method needs will have been calculated using a compliant method or will be unknown.
To see which standards a method complies with, look at the <code>:complies =&gt;</code> section of the code in the right column.</p>

<p>Client input complies with all standards.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-Collaboration'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Collaboration">&#182;</a>
        </div>
        <h4>Collaboration</h4>

<p>Contributions to this impact model are actively encouraged and warmly welcomed. This library includes a comprehensive test suite to ensure that your changes do not cause regressions. All changes should include test coverage for new functionality. Please see <a href="https://github.com/brighterplanet/sniff#readme">sniff</a>, our emitter testing framework, for more information.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="k">module</span> <span class="nn">BrighterPlanet</span>
  <span class="k">module</span> <span class="nn">BusTrip</span>
    <span class="k">module</span> <span class="nn">ImpactModel</span>
      <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
        <span class="n">base</span><span class="o">.</span><span class="n">decide</span> <span class="ss">:impact</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="ss">:characteristics</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-7'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-7">&#182;</a>
        </div>
        <hr />
      </td>
      <td class=code>
        <div class='highlight'><pre>          </pre></div>
      </td>
    </tr>
    <tr id='section-Carbon_(&lt;em&gt;kg_CO&lt;sub&gt;2&lt;/sub&gt;e&lt;/em&gt;)'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Carbon_(&lt;em&gt;kg_CO&lt;sub&gt;2&lt;/sub&gt;e&lt;/em&gt;)">&#182;</a>
        </div>
        <h3>Carbon (<em>kg CO<sub>2</sub>e</em>)</h3>

<p><em>One passenger&rsquo;s share of the trip&rsquo;s anthropogenic greenhouse gas emissions during <code>timeframe</code>.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:carbon</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-9'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-9">&#182;</a>
        </div>
        <p>Sum <code>co2 emission</code> (<em>kg</em>), <code>ch4 emission</code> (<em>kg CO<sub>2</sub>e</em>), <code>n2o emission</code> (<em>kg CO<sub>2</sub>e</em>), and <code>hfc emission</code> (<em>kg CO<sub>2</sub>e</em>) to give <em>kg CO<sub>2</sub>e</em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from co2 emission, ch4 emission, n2o emission, and hfc emission&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:co2_emission</span><span class="p">,</span> <span class="ss">:ch4_emission</span><span class="p">,</span> <span class="ss">:n2o_emission</span><span class="p">,</span> <span class="ss">:hfc_emission</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
              <span class="n">characteristics</span><span class="o">[</span><span class="ss">:co2_emission</span><span class="o">]</span> <span class="o">+</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:ch4_emission</span><span class="o">]</span> <span class="o">+</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:n2o_emission</span><span class="o">]</span> <span class="o">+</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:hfc_emission</span><span class="o">]</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-CO&lt;sub&gt;2&lt;/sub&gt;_emission_(&lt;em&gt;kg&lt;/em&gt;)'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-CO&lt;sub&gt;2&lt;/sub&gt;_emission_(&lt;em&gt;kg&lt;/em&gt;)">&#182;</a>
        </div>
        <h3>CO<sub>2</sub> emission (<em>kg</em>)</h3>

<p><em>One passenger&rsquo;s share of the trip&rsquo;s CO<sub>2</sub> emissions from anthropogenic sources during <code>timeframe</code>.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:co2_emission</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-11'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-11">&#182;</a>
        </div>
        <p>Multiply each <code>fuel use</code> (<em>l</em>) by the <a href="http://data.brighterplanet.com/bus_fuels">fuel</a>&rsquo;s co2 emission factor (<em>kg / l</em>) to give co2 emissions from each fuel (<em>kg</em>).
Sum the fuel co2 emissions to give <em>kg</em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from fuel uses&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:fuel_uses</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:gasoline</span><span class="o">]</span>  <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Gasoline&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_emission_factor</span> <span class="o">+</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:diesel</span><span class="o">]</span>    <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Diesel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_emission_factor</span> <span class="o">+</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:cng</span><span class="o">]</span>       <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;CNG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_emission_factor</span> <span class="o">+</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:lng</span><span class="o">]</span>       <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;LNG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_emission_factor</span> <span class="o">+</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:lpg</span><span class="o">]</span>       <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;LPG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_emission_factor</span> <span class="o">+</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:methanol</span><span class="o">]</span>  <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Methanol&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_emission_factor</span> <span class="o">+</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:biodiesel</span><span class="o">]</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Biodiesel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_emission_factor</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-CO&lt;sub&gt;2&lt;/sub&gt;_biogenic_emission_(&lt;em&gt;kg&lt;/em&gt;)'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-CO&lt;sub&gt;2&lt;/sub&gt;_biogenic_emission_(&lt;em&gt;kg&lt;/em&gt;)">&#182;</a>
        </div>
        <h2>CO<sub>2</sub> biogenic emission (<em>kg</em>)</h2>

<p>One passenger&rsquo;s share of the trip&rsquo;s CO<sub>2</sub> emissions from biogenic sources during <code>timeframe</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:co2_biogenic_emission</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-13'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-13">&#182;</a>
        </div>
        <p>Multiply each <code>fuel use</code> (<em>l</em>) by the <a href="http://data.brighterplanet.com/bus_fuels">fuel</a>&rsquo;s co2 biogenic emission factor (<em>kg / l</em>) to give co2 biogenic emissions from each fuel (<em>kg</em>).
Sum the fuel co2 biogenic emissions to give <em>kg</em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from fuel uses&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:fuel_uses</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:gasoline</span><span class="o">]</span>  <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Gasoline&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_biogenic_emission_factor</span> <span class="o">+</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:diesel</span><span class="o">]</span>    <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Diesel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_biogenic_emission_factor</span> <span class="o">+</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:cng</span><span class="o">]</span>       <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;CNG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_biogenic_emission_factor</span> <span class="o">+</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:lng</span><span class="o">]</span>       <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;LNG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_biogenic_emission_factor</span> <span class="o">+</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:lpg</span><span class="o">]</span>       <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;LPG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_biogenic_emission_factor</span> <span class="o">+</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:methanol</span><span class="o">]</span>  <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Methanol&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_biogenic_emission_factor</span> <span class="o">+</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:biodiesel</span><span class="o">]</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Biodiesel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_biogenic_emission_factor</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-CH&lt;sub&gt;4&lt;/sub&gt;_emission_(&lt;em&gt;kg_CO&lt;sub&gt;2&lt;/sub&gt;e&lt;/em&gt;)'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-CH&lt;sub&gt;4&lt;/sub&gt;_emission_(&lt;em&gt;kg_CO&lt;sub&gt;2&lt;/sub&gt;e&lt;/em&gt;)">&#182;</a>
        </div>
        <h3>CH<sub>4</sub> emission (<em>kg CO<sub>2</sub>e</em>)</h3>

<p><em>One passenger&rsquo;s share of the trip&rsquo;s CH<sub>4</sub> emissions during <code>timeframe</code>.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:ch4_emission</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-15'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-15">&#182;</a>
        </div>
        <p>Sum the <code>fuel uses</code> (<em>l</em>) to give total fuel use (<em>l</em>).
Divide each <code>fuel use</code> (<em>l</em>) by total fuel use (<em>l</em>) and multiply by <code>distance per passenger</code> (<em>km</em>) to give the distance attributed to each fuel (<em>km</em>).
Multiply the distance attributed to each fuel (<em>km</em>) by the <a href="http://data.brighterplanet.com/bus_fuels">fuel</a>&rsquo;s ch4 emission factor (<em>kg CO<sub>2</sub>e / km</em>) to give ch4 emissions from each fuel (<em>kg CO<sub>2</sub>e</em>).
Sum the fuel ch4 emissions to give <em>kg CO<sub>2</sub>e</em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from distance per passenger and fuel uses&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="p">,</span> <span class="ss">:fuel_uses</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">total_fuel</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">].</span><span class="n">values</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="ss">:+</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">total_fuel</span> <span class="o">&gt;</span> <span class="mi">0</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:gasoline</span><span class="o">]</span>  <span class="o">/</span> <span class="n">total_fuel</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="o">]</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Gasoline&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ch4_emission_factor</span> <span class="o">+</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:diesel</span><span class="o">]</span>    <span class="o">/</span> <span class="n">total_fuel</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="o">]</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Diesel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ch4_emission_factor</span> <span class="o">+</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:cng</span><span class="o">]</span>       <span class="o">/</span> <span class="n">total_fuel</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="o">]</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;CNG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ch4_emission_factor</span> <span class="o">+</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:lng</span><span class="o">]</span>       <span class="o">/</span> <span class="n">total_fuel</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="o">]</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;LNG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ch4_emission_factor</span> <span class="o">+</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:lpg</span><span class="o">]</span>       <span class="o">/</span> <span class="n">total_fuel</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="o">]</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;LPG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ch4_emission_factor</span> <span class="o">+</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:methanol</span><span class="o">]</span>  <span class="o">/</span> <span class="n">total_fuel</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="o">]</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Methanol&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ch4_emission_factor</span> <span class="o">+</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:biodiesel</span><span class="o">]</span> <span class="o">/</span> <span class="n">total_fuel</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="o">]</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Biodiesel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ch4_emission_factor</span>
                <span class="k">else</span>
                  <span class="mi">0</span>
                <span class="k">end</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-N&lt;sub&gt;2&lt;/sub&gt;O_emission_(&lt;em&gt;kg_CO&lt;sub&gt;2&lt;/sub&gt;e&lt;/em&gt;)'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-N&lt;sub&gt;2&lt;/sub&gt;O_emission_(&lt;em&gt;kg_CO&lt;sub&gt;2&lt;/sub&gt;e&lt;/em&gt;)">&#182;</a>
        </div>
        <h3>N<sub>2</sub>O emission (<em>kg CO<sub>2</sub>e</em>)</h3>

<p><em>One passenger&rsquo;s share of the trip&rsquo;s N<sub>2</sub>O emissions during <code>timeframe</code>.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:n2o_emission</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-17'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-17">&#182;</a>
        </div>
        <p>Sum the <code>fuel uses</code> (<em>l</em>) to give total fuel use (<em>l</em>).
Divide each <code>fuel use</code> (<em>l</em>) by total fuel use (<em>l</em>) and multiply by <code>distance per passenger</code> (<em>km</em>) to give the distance attributed to each fuel (<em>km</em>).
Multiply the distance attributed to each fuel (<em>km</em>) by the <a href="http://data.brighterplanet.com/bus_fuels">fuel</a>&rsquo;s n2o emission factor (<em>kg CO<sub>2</sub>e / km</em>) to give n2o emissions from each fuel (<em>kg CO<sub>2</sub>e</em>).
Sum the fuel n2o emissions to give <em>kg CO<sub>2</sub>e</em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from distance per passenger and fuel uses&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="p">,</span> <span class="ss">:fuel_uses</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">total_fuel</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">].</span><span class="n">values</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="ss">:+</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">total_fuel</span> <span class="o">&gt;</span> <span class="mi">0</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:gasoline</span><span class="o">]</span>  <span class="o">/</span> <span class="n">total_fuel</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="o">]</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Gasoline&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">n2o_emission_factor</span> <span class="o">+</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:diesel</span><span class="o">]</span>    <span class="o">/</span> <span class="n">total_fuel</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="o">]</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Diesel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">n2o_emission_factor</span> <span class="o">+</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:cng</span><span class="o">]</span>       <span class="o">/</span> <span class="n">total_fuel</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="o">]</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;CNG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">n2o_emission_factor</span> <span class="o">+</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:lng</span><span class="o">]</span>       <span class="o">/</span> <span class="n">total_fuel</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="o">]</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;LNG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">n2o_emission_factor</span> <span class="o">+</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:lpg</span><span class="o">]</span>       <span class="o">/</span> <span class="n">total_fuel</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="o">]</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;LPG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">n2o_emission_factor</span> <span class="o">+</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:methanol</span><span class="o">]</span>  <span class="o">/</span> <span class="n">total_fuel</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="o">]</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Methanol&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">n2o_emission_factor</span> <span class="o">+</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_uses</span><span class="o">][</span><span class="ss">:biodiesel</span><span class="o">]</span> <span class="o">/</span> <span class="n">total_fuel</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="o">]</span> <span class="o">*</span> <span class="no">BusFuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">&quot;Biodiesel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">n2o_emission_factor</span>
                <span class="k">else</span>
                  <span class="mi">0</span>
                <span class="k">end</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-HFC_emission_(&lt;em&gt;kg_CO&lt;sub&gt;2&lt;/sub&gt;e&lt;/em&gt;)'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-HFC_emission_(&lt;em&gt;kg_CO&lt;sub&gt;2&lt;/sub&gt;e&lt;/em&gt;)">&#182;</a>
        </div>
        <h3>HFC emission (<em>kg CO<sub>2</sub>e</em>)</h3>

<p><em>One passenger&rsquo;s share of the trip&rsquo;s HFC emissions during <code>timeframe</code>.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:hfc_emission</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-19'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-19">&#182;</a>
        </div>
        <p>Multiply <code>distance per passenger</code> (<em>km</em>) by the <code>bus class</code> air conditioning emission factor (<em>kg CO<sub>2</sub>e / km</em>) to give <em>kg CO<sub>2</sub>e</em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from distance per passenger and bus class&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="p">,</span> <span class="ss">:bus_class</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="o">]</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">air_conditioning_emission_factor</span>
            <span class="k">end</span>
          <span class="k">end</span>
          
<span class="cm">=begin</span></pre></div>
      </td>
    </tr>
    <tr id='section-Energy_(&lt;em&gt;MJ&lt;/em&gt;)'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Energy_(&lt;em&gt;MJ&lt;/em&gt;)">&#182;</a>
        </div>
        <h3>Energy (<em>MJ</em>)</h3>

<p><em>One passenger&rsquo;s share of the trip&rsquo;s energy use during <code>timeframe</code>.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="cm">          committee :energy do</span></pre></div>
      </td>
    </tr>
    <tr id='section-21'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-21">&#182;</a>
        </div>
        <p>Multiply each <code>fuel use</code> (<em>l</em>) by the <a href="http://data.brighterplanet.com/bus_fuels">fuel</a>&rsquo;s energy content (<em>MJ / l</em>) to give energy for each fuel (<em>MJ</em>).
Sum the fuel energies to give <em>MJ</em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="cm">            quorum &#39;from fuel uses&#39;, :needs =&gt; :fuel_uses do |characteristics|</span>
<span class="cm">              characteristics[:fuel_uses][:gasoline]  * BusFuel.find_by_name(&quot;Gasoline&quot;).energy_content +</span>
<span class="cm">              characteristics[:fuel_uses][:diesel]    * BusFuel.find_by_name(&quot;Diesel&quot;).energy_content +</span>
<span class="cm">              characteristics[:fuel_uses][:cng]       * BusFuel.find_by_name(&quot;CNG&quot;).energy_content +</span>
<span class="cm">              characteristics[:fuel_uses][:lng]       * BusFuel.find_by_name(&quot;LNG&quot;).energy_content +</span>
<span class="cm">              characteristics[:fuel_uses][:lpg]       * BusFuel.find_by_name(&quot;LPG&quot;).energy_content +</span>
<span class="cm">              characteristics[:fuel_uses][:methanol]  * BusFuel.find_by_name(&quot;Methanol&quot;).energy_content +</span>
<span class="cm">              characteristics[:fuel_uses][:biodiesel] * BusFuel.find_by_name(&quot;Biodiesel&quot;).energy_content</span>
<span class="cm">            end</span>
<span class="cm">          end</span>
<span class="cm">=end</span>

<span class="cm">=begin</span>
<span class="cm">  NOTE: electricity use is negligible (contributes about 0.001% of total emissions)</span>
<span class="cm">=end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Fuel_uses_(&lt;em&gt;l&lt;/em&gt;)'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Fuel_uses_(&lt;em&gt;l&lt;/em&gt;)">&#182;</a>
        </div>
        <h3>Fuel uses (<em>l</em>)</h3>

<p><em>One passenger&rsquo;s share of the trip&rsquo;s use of each of a variety of <a href="http://data.brighterplanet.com/bus_fuels">bus fuels</a> during <code>timeframe</code>.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:fuel_uses</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-23'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-23">&#182;</a>
        </div>
        <p>For each fuel, multiply <code>distance per passenger</code> (<em>km</em>) by the <code>bus class</code> fuel intensity for the fuel (<em>l / km</em>) to give <em>l</em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from distance per passenger and bus class&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="p">,</span> <span class="ss">:bus_class</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="p">{</span>
                  <span class="ss">:gasoline</span>  <span class="o">=&gt;</span> <span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="o">]</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">gasoline_intensity</span><span class="p">),</span>
                  <span class="ss">:diesel</span>    <span class="o">=&gt;</span> <span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="o">]</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">diesel_intensity</span><span class="p">),</span>
                  <span class="ss">:cng</span>       <span class="o">=&gt;</span> <span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="o">]</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">cng_intensity</span><span class="p">),</span>
                  <span class="ss">:lng</span>       <span class="o">=&gt;</span> <span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="o">]</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">lng_intensity</span><span class="p">),</span>
                  <span class="ss">:lpg</span>       <span class="o">=&gt;</span> <span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="o">]</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">lpg_intensity</span><span class="p">),</span>
                  <span class="ss">:methanol</span>  <span class="o">=&gt;</span> <span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="o">]</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">methanol_intensity</span><span class="p">),</span>
                  <span class="ss">:biodiesel</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance_per_passenger</span><span class="o">]</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">biodiesel_intensity</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Distance_per_passenger_(&lt;em&gt;km&lt;/em&gt;)'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Distance_per_passenger_(&lt;em&gt;km&lt;/em&gt;)">&#182;</a>
        </div>
        <h3>Distance per passenger (<em>km</em>)</h3>

<p><em>The distance traveled per passenger during <code>timeframe</code>.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:distance_per_passenger</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-25'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-25">&#182;</a>
        </div>
        <p>If <code>date</code> falls within <code>timeframe</code>, divide <code>distance</code> (<em>km</em>) by <code>passengers</code> to give <em>km</em>.
Otherwise distance per passenger is zero.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from distance, passengers, date, and timeframe&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:distance</span><span class="p">,</span> <span class="ss">:passengers</span><span class="p">,</span> <span class="ss">:date</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="p">,</span> <span class="n">timeframe</span><span class="o">|</span>
<span class="cm">=begin</span>
<span class="cm">  FIXME TODO date should already be coerced</span>
<span class="cm">=end</span>
                <span class="n">date</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">].</span><span class="n">is_a?</span><span class="p">(</span><span class="no">Date</span><span class="p">)</span> <span class="p">?</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">]</span> <span class="p">:</span> <span class="no">Date</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">].</span><span class="n">to_s</span><span class="p">)</span>
                <span class="n">timeframe</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="p">?</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance</span><span class="o">]</span> <span class="o">/</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:passengers</span><span class="o">]</span> <span class="p">:</span> <span class="mi">0</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Distance_(&lt;em&gt;km&lt;/em&gt;)'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Distance_(&lt;em&gt;km&lt;/em&gt;)">&#182;</a>
        </div>
        <h3>Distance (<em>km</em>)</h3>

<p><em>The trip&rsquo;s distance.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:distance</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-27'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-27">&#182;</a>
        </div>
        <p>Use client input, if available.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            </pre></div>
      </td>
    </tr>
    <tr id='section-28'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-28">&#182;</a>
        </div>
        <p>Otherwise divide <code>duration</code> (<em>seconds</em>) by 3600 (<em>seconds / hour</em>) and multiply by <code>speed</code> (<em>km / hour</em>) to give <em>km</em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from duration and speed&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:duration</span><span class="p">,</span> <span class="ss">:speed</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:duration</span><span class="o">]</span> <span class="o">/</span> <span class="mi">3600</span><span class="o">.</span><span class="mi">0</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:speed</span><span class="o">]</span>
            <span class="k">end</span>
            </pre></div>
      </td>
    </tr>
    <tr id='section-29'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-29">&#182;</a>
        </div>
        <p>Otherwise use the <code>bus class</code> average trip distance (<em>km</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from bus class&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:bus_class</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
              <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">distance</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Speed_(&lt;em&gt;km_/_hour&lt;/em&gt;)'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Speed_(&lt;em&gt;km_/_hour&lt;/em&gt;)">&#182;</a>
        </div>
        <h3>Speed (<em>km / hour</em>)</h3>

<p><em>The trip&rsquo;s average speed.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:speed</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-31'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-31">&#182;</a>
        </div>
        <p>Use the <a href="http://data.brighterplanet.com/bus_classes">bus class</a> average speed (<em>km / hour</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from bus class&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:bus_class</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">speed</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Duration_(&lt;em&gt;seconds&lt;/em&gt;)'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Duration_(&lt;em&gt;seconds&lt;/em&gt;)">&#182;</a>
        </div>
        <h3>Duration (<em>seconds</em>)</h3>

<p><em>The trip&rsquo;s duration.</em></p>

<p>Use client input, if available.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          </pre></div>
      </td>
    </tr>
    <tr id='section-Passengers'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Passengers">&#182;</a>
        </div>
        <h3>Passengers</h3>

<p><em>The number of passengers on the bus.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:passengers</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-34'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-34">&#182;</a>
        </div>
        <p>Use the <a href="http://data.brighterplanet.com/bus_classes">bus class</a> average number of passengers.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from bus class&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:bus_class</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:bus_class</span><span class="o">].</span><span class="n">passengers</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Bus_class'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Bus_class">&#182;</a>
        </div>
        <h3>Bus class</h3>

<p><em>The type of bus used.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:bus_class</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-36'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-36">&#182;</a>
        </div>
        <p>Use client input, if available.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            </pre></div>
      </td>
    </tr>
    <tr id='section-37'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-37">&#182;</a>
        </div>
        <p>Otherwise use an artificial <a href="http://data.brighterplanet.com/bus_classes">bus class</a> that represents US averages.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span>
                <span class="no">BusClass</span><span class="o">.</span><span class="n">fallback</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Date_(&lt;em&gt;date&lt;/em&gt;)'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Date_(&lt;em&gt;date&lt;/em&gt;)">&#182;</a>
        </div>
        <h3>Date (<em>date</em>)</h3>

<p><em>The day the trip occurred.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:date</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-39'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-39">&#182;</a>
        </div>
        <p>Use client input, if available.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            </pre></div>
      </td>
    </tr>
    <tr id='section-40'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-40">&#182;</a>
        </div>
        <p>Otherwise use the first day of <code>timeframe</code>.</p>

      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from timeframe&#39;</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="p">,</span> <span class="n">timeframe</span><span class="o">|</span>
                <span class="n">timeframe</span><span class="o">.</span><span class="n">from</span>
            <span class="k">end</span>
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
